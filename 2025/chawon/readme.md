## Chawon
자영업자를 대상으로 개인 브랜딩 및 웹사이트를 빠르고 간단하게 제작할수있는 saas형 웹 빌더 서비스의 백엔드 설계와 개발을 담당하였습니다.
진행 기간: 2025/06 ~ 2025/09
**프로젝트 최종 무산**
## 기술 스택
### Backend
* Nest.js
* postgresql
* prisma
### Cloud(AWS)
* ec2
* rds
* lambda
* cloudfront
* ses
* sqs
* eventBridge
### ETC
* 구글 oauth
* 카카오 oauth
* 카카오 알림톡 발송(nhn 클라우드)

## 핵심 담당 업무
프로젝트의 요구사항을 분석하고 초기에 기술스택을 선정할때 supabase와 aws + Nest.js로 백엔드 구현 중 요구사항이 복잡하여 nest.js를 선택하는것이 더욱 적절하다고 판단되어어 기술스택을 확정하고 백엔드 기능을 설계하였습니다.
### 클라우드 비용 최소화
내부 테스트용 서버와 실제 프로덕션용 서버의 주소를 각각 `test.chawon.com` 과 `api.chawon.com` 으로 분리하였습니다.  
테스트 서버 특성상 자주 변경되고 사양이 높을 필요가 없기때문에 t2.micro ec2 인스턴스에서 직접 백엔드 서비스를 실행하도록 했습니다.  
하지만 테스트용과 실제 프로덕션용 서버를 분리해야했는데 초기단계에서는 클라우드 비용이 발생하지 않도록 프리티어 한도 내에서 아키텍쳐를 구성해야 했습니다.  
이미 프리티어 인스턴스를 테스트용으로 사용하고있었기때문에 serverless 프레임워크를 이용한 aws 람다로 프로덕션 서버를 구성하기로 했습니다.

**겪었던 문제점과 해결 방법**
1. 람다의 코드 용량 250Mib 제한
람다에서 실행할 소스코드를 업로드할때 250Mib의 크기 제한이 있었습니다. 이전에 express나 koa같은 경량 프레임워크는 문제가되지 않았지만 nest.js와 같이 기능이 많고 규모가 큰 프레임워크는 쉽게 용량 초과가 났습니다.
처음에는 serverless 플러그인과 yml을 통해 안쓰는 패키지와 캐시를 전부삭제하고 빌드된 js파일만 업로드하는등 여러가지 방법을 시도해 겨우 250Mib 제한을 맞춰서 배포를 했었습니다.
하지만 초기단계에 기능이 별로 없는 상태에서도 겨우 성공했는데 추후 기능이 추가되며 새로운 패키지를 설치할경우 반드시 제한에 걸릴수있는 상태였습니다.
이 문제에대하여 고민을 하다 우연히 `severless-esbuild` 플러그인의 `번들링` 기능을 발견하였습니다. 이 옵션을 적용하여 기존 **300Mib** 였던 빌드 파일이 **4~5Mib** 수준의 단일 js파일로 빌드되어 용량 문제를 해결하였습니다.

2. vpc 내부의 람다에서 외부 인터넷 접근
프로덕션 람다 함수를 vpc 안에서 배포를 했는데 다른 기능은 정상적으로 작동했지만 구글,카카오 oauth, 알림톡 발송과 같은 외부 인터넷과 연결이 필요한 기능이 동작하지 않았습니다.
조사결과 vpc 내부에 있는 람다는 외부 인터넷에 연결하기 위해선 반드시 NAT 게이트웨이가 필요한게 원인이었습니다.  
하지만 NAT 게이트웨는 비용이 발생하며 오히려 새로운 ec2 인스턴스를 사용하는것보다 2배는 비싼 요금이었습니다.
그래서 이를 어떻게 우회를 해야할까 고민을 하다 로그인이나 알림톡같은 외부 api를 사용하는 기능 자체를 하나의 람다로 분리하고 이 람다 함수를 vpc 외부에 배포를하고 백엔드 함수에서 이 외부 람다 함수를 호출하면 어떨까 라는 생각으로 직접 구현했습니다.
VPC 내부의 람다에서 외부의 람다를 호출하기 위해선 `VPC 엔드 포인트` 라는 기능이 필요했습니다. 이 또한 비용이 발생하는 서비스였지만 새로운 ec2 인스턴스를 사용하는것 보다는 저렴한 가격이었습니다.  
